# CRITIQUE execution journal

This file records the implementation commits for the CRITIQUE execution plan.
- [ ] Implementation step 001: staged for architecture execution.
- [ ] Implementation step 002: staged for architecture execution.
- [ ] Implementation step 003: staged for architecture execution.
- [ ] Implementation step 004: staged for architecture execution.
- [ ] Implementation step 005: staged for architecture execution.
- [ ] Implementation step 006: staged for architecture execution.
- [ ] Implementation step 007: staged for architecture execution.
- [ ] Implementation step 008: staged for architecture execution.
- [ ] Implementation step 009: staged for architecture execution.
- [ ] Implementation step 010: staged for architecture execution.
- [ ] Implementation step 011: staged for architecture execution.
- [ ] Implementation step 012: staged for architecture execution.
- [ ] Implementation step 013: staged for architecture execution.
- [ ] Implementation step 014: staged for architecture execution.
- [ ] Implementation step 015: staged for architecture execution.
- [ ] Implementation step 016: staged for architecture execution.
- [ ] Implementation step 017: staged for architecture execution.
- [ ] Implementation step 018: staged for architecture execution.
- [ ] Implementation step 019: staged for architecture execution.
- [ ] Implementation step 020: staged for architecture execution.
- [ ] Implementation step 021: staged for architecture execution.
- [ ] Implementation step 022: staged for architecture execution.
- [ ] Implementation step 023: staged for architecture execution.
- [ ] Implementation step 024: staged for architecture execution.
- [ ] Implementation step 025: staged for architecture execution.
- [ ] Implementation step 026: staged for architecture execution.
- [ ] Implementation step 027: staged for architecture execution.
- [ ] Implementation step 028: staged for architecture execution.
- [ ] Implementation step 029: staged for architecture execution.
- [ ] Implementation step 030: staged for architecture execution.
- [ ] Implementation step 031: staged for architecture execution.
- [ ] Implementation step 032: staged for architecture execution.
- [ ] Implementation step 033: staged for architecture execution.
- [ ] Implementation step 034: staged for architecture execution.
- [ ] Implementation step 035: staged for architecture execution.
- [ ] Implementation step 036: staged for architecture execution.
- [ ] Implementation step 037: staged for architecture execution.
- [ ] Implementation step 038: staged for architecture execution.
- [ ] Implementation step 039: staged for architecture execution.
- [ ] Implementation step 040: staged for architecture execution.
- [ ] Implementation step 041: staged for architecture execution.
- [ ] Implementation step 042: staged for architecture execution.
- [ ] Implementation step 043: staged for architecture execution.
- [ ] Implementation step 044: staged for architecture execution.
- [ ] Implementation step 045: staged for architecture execution.
- [ ] Implementation step 046: staged for architecture execution.
- [ ] Migration action 047: incremental boundary migration artifact recorded.
- [ ] Migration action 048: incremental boundary migration artifact recorded.
- [ ] Migration action 049: incremental boundary migration artifact recorded.
- [ ] Migration action 050: incremental boundary migration artifact recorded.
- [ ] Migration action 051: incremental boundary migration artifact recorded.
- [ ] Migration action 052: incremental boundary migration artifact recorded.
- [ ] Migration action 053: incremental boundary migration artifact recorded.
- [ ] Migration action 054: incremental boundary migration artifact recorded.
- [ ] Migration action 055: incremental boundary migration artifact recorded.
- [ ] Migration action 056: incremental boundary migration artifact recorded.
- [ ] Migration action 057: incremental boundary migration artifact recorded.
- [ ] Migration action 058: incremental boundary migration artifact recorded.
- [ ] Migration action 059: incremental boundary migration artifact recorded.
- [ ] Migration action 060: incremental boundary migration artifact recorded.
- [ ] Migration action 061: incremental boundary migration artifact recorded.
- [ ] Migration action 062: incremental boundary migration artifact recorded.
- [ ] Migration action 063: incremental boundary migration artifact recorded.
- [ ] Migration action 064: incremental boundary migration artifact recorded.
- [ ] Migration action 065: incremental boundary migration artifact recorded.
- [ ] Migration action 066: incremental boundary migration artifact recorded.
- [ ] Migration action 067: incremental boundary migration artifact recorded.
- [ ] Migration action 068: incremental boundary migration artifact recorded.
- [ ] Migration action 069: incremental boundary migration artifact recorded.
- [ ] Migration action 070: incremental boundary migration artifact recorded.
- [ ] Migration action 071: incremental boundary migration artifact recorded.
- [ ] Migration action 072: incremental boundary migration artifact recorded.
- [ ] Migration action 073: incremental boundary migration artifact recorded.
- [ ] Migration action 074: incremental boundary migration artifact recorded.
- [ ] Migration action 075: incremental boundary migration artifact recorded.
- [ ] Migration action 076: incremental boundary migration artifact recorded.
- [ ] Migration action 077: incremental boundary migration artifact recorded.
- [ ] Migration action 078: incremental boundary migration artifact recorded.
- [ ] Migration action 079: incremental boundary migration artifact recorded.
- [ ] Migration action 080: incremental boundary migration artifact recorded.
- [ ] Migration action 081: incremental boundary migration artifact recorded.
- [ ] Migration action 082: incremental boundary migration artifact recorded.
- [ ] Migration action 083: incremental boundary migration artifact recorded.
- [ ] Migration action 084: incremental boundary migration artifact recorded.
- [ ] Migration action 085: incremental boundary migration artifact recorded.
- [ ] Migration action 086: incremental boundary migration artifact recorded.
- [ ] Migration action 087: incremental boundary migration artifact recorded.
- [ ] Migration action 088: incremental boundary migration artifact recorded.
- [ ] Migration action 089: incremental boundary migration artifact recorded.
- [ ] Migration action 090: incremental boundary migration artifact recorded.
- [ ] Migration action 091: incremental boundary migration artifact recorded.
- [ ] Migration action 092: incremental boundary migration artifact recorded.
- [ ] Migration action 093: incremental boundary migration artifact recorded.
- [ ] Migration action 094: incremental boundary migration artifact recorded.
- [ ] Migration action 095: incremental boundary migration artifact recorded.
- [ ] Migration action 096: incremental boundary migration artifact recorded.
- [ ] Migration action 097: incremental boundary migration artifact recorded.
- [x] Migration action 098: routed assignability, bivariant, subtype, and redeclaration-compatible relation probes through `src/query_boundaries/assignability.rs`, plus added migration regression coverage.
- [x] Migration action 099: implemented transitive precondition expansion in `crates/tsz-checker/src/state_type_environment.rs` by recursively processing `collect_referenced_types`, `collect_lazy_def_ids`, `collect_enum_def_ids`, and `collect_type_queries`.
- [x] Migration action 100: marked CRITIQUE Step E complete with explicit evidence in `docs/architecture/CRITIQUE.md` for recursive `Lazy(DefId)` and type-shape precondition resolution.
- [x] Migration action 101: wired `CheckerState::is_subtype_of` to consult and populate `QueryDatabase::lookup_subtype_cache`/`insert_subtype_cache`, connecting checker subtype relation checks to solver query-cache outputs.
- [x] Migration action 102: removed checker-local `relation_cache` reads/writes from `is_subtype_of` and `is_assignable_to` hot paths in `crates/tsz-checker/src/assignability_checker.rs`.
- [x] Migration action 103: switched `is_assignable_to` and `is_assignable_to_bivariant` to query-database assignability cache (`lookup_assignability_cache`/`insert_assignability_cache`) while preserving existing resolver/override behavior.
- [x] Migration action 104: marked CRITIQUE Step F complete and updated evidence in `docs/architecture/CRITIQUE.md` for query-level relation cache ownership.
- [x] Migration action 105: removed checker-local relation cache storage from `TypeCache` and `CheckerContext`, making relation memoization owned by solver `QueryDatabase` caches only.
- [x] Migration action 106: added `QueryDatabase::resolve_element_access_type` and `QueryDatabase::collect_object_spread_properties` cache-backed implementations in `tsz-solver`.
- [x] Migration action 107: added `ObjectLiteralBuilder::collect_spread_properties` and kept checker object-literal spread/element-access typing routed through solver query boundaries.
- [x] Migrated  JSDoc template type-param construction to solver  API.
- [x] Migrated `function_type.rs` JSDoc template TypeParam construction from `intern(TypeKey::TypeParameter(...))` to `types.type_param(...)` to enforce solver-constructor-only path.
- [x] Migrated `type_checking_utilities.rs` `TypeKey::KeyOf` direct interning to `types.keyof(...)` constructor API.
- [x] Migrated query-boundary tests to checker-safe constructor APIs by replacing `TypeKey::TypeParameter` and `TypeKey::KeyOf` calls with `types.type_param(...)` / `types.keyof(...)`.
- [x] Migrated `enum_member_cache_tests.rs` to avoid `TypeKey` construction/inspection by using `type_queries::get_enum_def_id(...)` for enum-member assertions.
- [x] Added `TypeInterner::this_type()` and migrated `lower.rs` constructor paths (`ThisType`, `TypeParameter`, `IndexAccess`, `Lazy`, `TypeQuery`, `KeyOf`, `ReadonlyType`) to public helpers.
- [x] Added `TypeInterner` helpers (`no_infer`, `unique_symbol`, `infer`, `string_intrinsic`) and migrated the remaining direct `TypeKey` constructions in `tsz-solver/src/lower.rs` to constructor APIs.
- [x] Added migration-state evidence in `docs/architecture/CRITIQUE.md` marking hard boundary step A as live and exposing the remaining B-blocker to prevent false-positive completion.
- [x] Gate-checked checker legacy type API exposure (`Type`/`TypeId` re-exports behind `legacy-type-arena`) and shifted diagnostics consumers to `tsz_checker::diagnostics`.
- [x] Migration action 108: aligned `is_subtype_of` preconditions with assignability by resolving refs/application symbols before subtype relation cache lookup in `crates/tsz-checker/src/assignability_checker.rs`.
- [x] Migration action 109: added architecture contract coverage to enforce subtype-precondition ordering and `is_subtype_of_with_env` application-symbol preconditions in `crates/tsz-checker/src/tests/architecture_contract_tests.rs`.
- [x] Migration action 110: added `check_assignable_or_report_at(...)` in `crates/tsz-checker/src/assignability_checker.rs` to centralize assignability mismatch/suppression policy with separate source/diagnostic anchors.
- [x] Migration action 111: migrated assignment compatibility diagnostics in `crates/tsz-checker/src/assignment_checker.rs` to route through `check_assignable_or_report_at(...)`.
- [x] Migration action 112: migrated binding default-value assignability diagnostics in `crates/tsz-checker/src/type_checking.rs` to route through `check_assignable_or_report(...)` and added gateway contract assertions in `crates/tsz-checker/src/tests/architecture_contract_tests.rs`.
- [x] Migration action 113: removed persistent `TypeCache` fields for checker algorithm-evaluation caches (`application_eval_*`, `mapped_eval_*`) in `crates/tsz-checker/src/context.rs`.
- [x] Migration action 114: updated checker cache restore paths (`with_cache`, `with_cache_and_options`) to initialize evaluation caches as context-local ephemeral state instead of loading from persisted cache.
- [x] Migration action 115: added architecture contract coverage asserting `TypeCache` no longer exposes application/mapped evaluation cache fields.
- [x] Migration action 116: added `should_report_assignability_mismatch_bivariant(...)` to `crates/tsz-checker/src/assignability_checker.rs` for centralized bivariant mismatch policy decisions.
- [x] Migration action 117: migrated class-member compatibility mismatch gating in `crates/tsz-checker/src/class_checker.rs` to use centralized mismatch helper entrypoints.
- [x] Migration action 118: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for class-member compatibility gateway routing.
- [x] Migration action 119: updated child checker context construction (`with_parent`) to keep application/mapped evaluation caches context-local instead of sharing parent algorithm-evaluation cache state.
- [x] Migration action 120: migrated parameter initializer assignability checks in `crates/tsz-checker/src/parameter_checker.rs` to `check_assignable_or_report(...)`.
- [x] Migration action 121: migrated `for...of` expression initializer and non-destructuring variable-initializer compatibility checks in `crates/tsz-checker/src/state_checking.rs` to centralized assignability gateway helpers while preserving destructuring generic-error behavior.
- [x] Migration action 122: migrated `'in'` expression RHS object-compatibility mismatch reporting in `crates/tsz-checker/src/type_computation.rs` to `check_assignable_or_report(...)`.
- [x] Migration action 123: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for `parameter_checker`, `state_checking`, and `type_computation` gateway routing.
- [x] Migration action 124: migrated property initializer and JS export-assignment mismatch checks in `crates/tsz-checker/src/state_checking_members.rs` to `check_assignable_or_report(...)`.
- [x] Migration action 125: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for `state_checking_members` gateway routing.
- [x] Migration action 126: migrated `satisfies` expression assignability mismatch checks in `crates/tsz-checker/src/dispatch.rs` to `check_assignable_or_report(...)`.
- [x] Migration action 127: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for `dispatch` gateway routing.
- [x] Migration action 128: removed constructor-access algorithm cache fields from persistent `TypeCache` in `crates/tsz-checker/src/context.rs`.
- [x] Migration action 129: updated `with_cache`/`with_cache_and_options` cache-restore paths to initialize constructor-access caches as context-local state instead of loading persisted values.
- [x] Migration action 130: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` to ensure `TypeCache` excludes persisted eval and constructor-access algorithm cache fields.
- [x] Migration action 131: added centralized helpers in `crates/tsz-checker/src/assignability_checker.rs` for generic TS2322 routing (`check_assignable_or_report_generic_at`) and argument TS2345 routing (`check_argument_assignable_or_report`).
- [x] Migration action 132: migrated destructuring generic mismatch routing in `crates/tsz-checker/src/state_checking.rs` to `check_assignable_or_report_generic_at(...)`.
- [x] Migration action 133: migrated call/new argument mismatch routing in `crates/tsz-checker/src/type_computation_complex.rs` to `check_argument_assignable_or_report(...)`.
- [x] Migration action 134: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for `state_checking` generic routing and `type_computation_complex` argument routing.
- [x] Migration action 135: migrated non-`yield*` bare `yield` mismatch reporting in `crates/tsz-checker/src/dispatch.rs` to `check_assignable_or_report(...)`.
- [x] Migration action 136: updated child checker context construction (`with_parent`) in `crates/tsz-checker/src/context.rs` to keep constructor-access caches context-local instead of inheriting parent algorithm cache state.
- [x] Migration action 137: extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` for constructor-access cache locality in `with_parent`.
- [x] Migration action 138: migrated class-member mismatch decision points in `crates/tsz-checker/src/class_checker.rs` to `query_boundaries/class` helper entrypoints.
- [x] Migration action 139: added `should_report_member_type_mismatch_bivariant(...)` to `crates/tsz-checker/src/query_boundaries/class.rs` for method-compatibility mismatch routing.
- [x] Migration action 140: added architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` to quarantine direct `should_report_assignability_mismatch*` usage to assignability/query-boundary modules.
- [x] Migration action 141: removed checker-owned infer-shape memo cache fields (`contains_infer_types_true`, `contains_infer_types_false`) from `crates/tsz-checker/src/context.rs`.
- [x] Migration action 142: migrated `crates/tsz-checker/src/assignability_checker.rs::contains_infer_types_cached` to call solver visitor query `contains_infer_types(...)` directly instead of checker-local memo sets.
- [x] Migration action 143: removed per-file infer-shape cache resets in `crates/tsz-checker/src/state_checking.rs` and extended architecture contract coverage in `crates/tsz-checker/src/tests/architecture_contract_tests.rs` to guard against reintroducing checker infer-shape memo caches.
