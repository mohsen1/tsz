Conformance Test Improvement: TS18013 and TS18016
==================================================

Date: 2026-02-09
Session: https://claude.ai/code/session_01BUuJsGfUqEKJ9ecFqev7hV
Branch: claude/improve-conformance-tests-nGsTY
Commit: fb0e2f2

SUMMARY
-------
Implemented validation for two TypeScript private identifier error cases:
- TS18013: Property not accessible outside class because it has a private identifier
- TS18016: Private identifiers are not allowed outside class bodies

BASELINE (Before Changes)
--------------------------
Slice 3 (offset 6318, max 3159): 1556/2764 passed (56.3%)

AFTER IMPLEMENTATION
--------------------
Slice 3 (offset 6318, max 3159): 1565/2764 passed (56.6%)

IMPROVEMENT
-----------
- Tests improved: +9 tests
- Percentage improvement: +0.3 percentage points
- Tests now correctly emitting TS18013 or TS18016

VERIFIED FIXES
--------------
1. privateNameInObjectLiteral-3.ts
   - Before: Missing TS18016
   - After: Correctly emits TS18016 ✓
   - Only missing TS18028 (ES5 target, separate issue)

2. esDecorators-privateFieldAccess.ts
   - Before: Missing TS18013
   - After: Correctly emits TS18013 ✓
   - Only missing TS18016 in specific context

IMPLEMENTATION DETAILS
----------------------
Files Modified:
1. crates/tsz-parser/src/parser/state_expressions.rs
   - Added TS18016 validation in parse_property_assignment
   - Added TS18016 validation in parse_object_get_accessor
   - Added TS18016 validation in parse_object_set_accessor
   - Added TS18016 validation in parse_object_method

2. crates/tsz-checker/src/state_type_analysis.rs
   - Enhanced get_type_of_private_property_access
   - Added check for !saw_class_scope → emit TS18013
   - Added validation in 3 code paths for complete coverage

3. crates/tsz-checker/src/tests/conformance_issues.rs
   - Added test_private_identifier_in_object_literal
   - Added test_private_identifier_access_outside_class
   - Added test_private_identifier_access_inside_class
   - All tests passing ✓

VALIDATION
----------
Unit Tests: 5/5 passing
- test_private_identifier_in_object_literal ✓
- test_private_identifier_access_outside_class ✓
- test_private_identifier_access_inside_class ✓
- test_private_identifier_in_ambient_class_2819 ✓
- test_private_identifier_in_non_ambient_class_ok ✓

Manual Testing:
- Verified TS18016 for `{ #x: 1 }` ✓
- Verified TS18013 for `f.#bar` outside class ✓
- Verified no error for `this.#bar` inside class ✓

NOTES
-----
- This addresses Pattern #3 from conformance-analysis-slice3.md
- Complexity was MEDIUM (3-7 days estimated, completed in 1 session)
- No breaking changes to existing functionality
- All error messages match TSC output format
