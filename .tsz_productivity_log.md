# tsz-1 Conformance Improvement Log
Started: 2026-02-15T18:10:00-05:00

- 18:10:00: Binary-text detection update committed to this session (TS1490/TS1005 focus). TransportStream.ts now emits TS1490 via parser binary check.

- 18:20:00: Committed + rebased + pushed `ce9a25427` (Improve binary text detection for TS1490). Verified `TransportStream.ts` now passes and TS1005 slice remains same count (94 missing / 55 extra) at this stage.

- 18:26:14: Added TS1005 recovery in parse_decorated_class_expression (non-class decorators in expression context). `decoratorOnArrowFunction.ts` and `decoratorOnFunctionExpression.ts` now pass in focused TS conformance; TS1005 slice all-missing count unchanged at 20, extra TS1005 count moved to 49. Prepared commit pending.

- 18:35:00: Committed `127e53918` and completed required sync (`git pull --rebase origin main` then push). Local HEAD now at `0a51f9bc0` after rebase + push.

- 18:32:54: Added object-literal semicolon EOF recovery in `parse_object_literal` (emit comma expected for semicolon-at-EOF, break). `objectLiteralWithSemicolons4.ts` now passes; TS1005 all-missing count dropped to 91, close-to-passing list stable at 85.

- 18:37:10: Committed `e412790ed` and completed sync (`git pull --rebase origin main` then push), final pushed commit now `f0d6b1931`.
- 18:46:53: Fixed object-binding keyword identifier parsing in binding patterns (`parse_object_binding_pattern` + `parse_binding_element_name`), passing 4 `objectBindingPatternKeywordIdentifiers*` tests.
- 18:56:57: Fixed parser regex-literal recovery in parse_regex_literal to emit TS1005 for unmatched regex substructures; passes parser579071.ts.
- 18:58:00: Committed ed79238b0 and pushed (`Fix parser recovery for incomplete regex groups`), parser579071 passes; TS1005 all-missing reduced to 14.
- 19:02:22: Added shared type-member separator recovery (`parse_type_member_separator_with_asi`) and applied to interface/type-literal member loops. `objectTypeLiteralSyntax2.ts` now passes; TS1005 missing reduced by 1 (14â†’13 in analyze output).
- 19:04:20: Ran focused conformance (`objectTypeLiteralSyntax2.ts`) and got pass. Committed and pushed `2a23536db` (rebased to `1554a8c18`), reducing TS1005 missing list by one in analyze output.
- 20:36:35: Fixed conditional `look_ahead_is_arrow_function` parse to avoid treating parenthesized false-branch expressions as arrow return types. `parserArrowFunctionExpression6.ts` now passes; focused TS1005 false-positive count improved.
- 20:50:10: Reworked `<<` primary-token handling in `parse_primary_expression` to emit TS1109 for ambiguous generic assertion ambiguity case; `ambiguousGenericAssertion1.ts` now passes (100%). TS1005 slice run (`--error-code 1005 --max 400`) remained at 358/400 passed with expected top mismatches unchanged.

- 2026-02-15T20:57:49:z: Focused TS1005 pass for class-member export-type parser recovery
  - classMemberWithMissingIdentifier.ts: pass for TS1005 slice
  - classMemberWithMissingIdentifier2.ts: TS1005/TS1146/TS1128 now matched (remaining TS2693 mismatch)
  - commonJsExportTypeDeclarationError.ts: TS1005/TS1110 removed in parser slice
  - TS1005 --max 400 now 359/400 passed (remaining top mismatches are non-1005 codes)
- 20:23:17: Added TS1029 recovery for `@decorator default ...` in `parse_decorated_declaration`. `defaultKeywordWithoutExport1.ts` now passes; TS1005-focused failures reduced from 8 to 7.

- 2026-02-15 21:34:26 CET: Applied YieldKeyword statement-start recovery in parser (`parse.is_statement_start`) and added regression test
  `test_generator_recovery_keeps_yield_statement_after_broken_initializer` in `parser_improvement_tests.rs`.
  Result: new parser test passes; focused TS1005 slice (`--error-code 1005 --filter parser --max 500`) still shows existing parser recoveries remaining.

- 2026-02-15 22:32:00+01:00: Reworked minimal arrow-function recovery for `parserArrowFunctionExpression2/3`: added parenthesized-expression context flag and guarded binary recovery stop before `||` when left side is assignment to block-bodied arrow, so `parserArrowFunctionExpression2.ts` now emits the expected TS1005. `parserArrowFunctionExpression3.ts` remains TS2872-only miss.

- 2026-02-16 00:57:16 +0100: Focus on TS2307 continued:
  - Implemented conformance tsconfig handling for nested `tsconfig.json` files: `copy_tsconfig_to_root_if_needed` now writes a root wrapper with `extends` when the fixture tsconfig is nested (preserving relative `extends` paths), and added regression in `crates/conformance/tests/tsz_wrapper.rs`.
  - Kept previous TS2307 fixes for path-mapping without `baseUrl` (`src/config.rs`, `src/module_resolver.rs`, `crates/tsz-cli/src/driver_resolution.rs`) and updated test expectations in `crates/tsz-cli/tests/config_tests.rs`.
  - Verified `pathMappingWithoutBaseUrl2.ts` now passes in `conformance --filter pathMappingWithoutBaseUrl2.ts --error-code 2307`.
  - `./scripts/conformance.sh analyze --error-code 2307` shows TS2307 missing reduced to 203 (from 207).
2026-02-16 01:06:53
Iteration: added PathMappingFailed fallback in driver.rs for module resolution; commit target TS2307 path mapping suite
2026-02-16 01:08:03
Iteration 2: changed module_resolver to delay PathMappingFailed return and allow classic fallback after unresolved mappings.
2026-02-16 02:07:00
Iteration 3: constrained TS2792 escalation to extensionless bare specifiers only and fixed
`resolutionCandidateFromPackageJsonField2.ts` to emit TS2307 (explicit `.ts` imports keep TS2307).

- 2026-02-16 02:15:17: TS2307 loop success. Updated `crates/tsz-checker/src/module_checker.rs` to route unresolved export module specifiers through driver resolution diagnostics (TS2792/TS283x) and dedupe via `modules_with_ts2307_emitted`; made `module_not_found_diagnostic` public in `crates/tsz-checker/src/import_checker.rs`. Verified pass for `pathMappingBasedModuleResolution6_classic.ts` and `resolutionCandidateFromPackageJsonField2.ts` via `scripts/conformance.sh run --filter ... --compare-fingerprints`.
