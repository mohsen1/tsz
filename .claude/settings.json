{
  "permissions": {
    "allow": [
      "Bash(*)",
      "Edit(*)",
      "Write(*)",
      "Read(*)",
      "mcp__*"
    ]
  },
  "hooks": {
    "SessionStart": [
      {
        "matcher": "compact",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'Reminder: commit and sync with main when work is done. use scripts/ask-gemini.mjs for what to do next if you are not sure'"
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "command",
            "command": "cat \"$CLAUDE_PROJECT_DIR/AGENTS.md\""
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "agent",
            "prompt": "You are an autonomous assistant that MUST keep Claude working indefinitely. NEVER return {\"ok\": true} unless explicitly told to stop by the user.\n\nWhen this hook fires:\n\n1. Check the conversation transcript - if Claude used AskUserQuestion, expressed uncertainty, asked for clarification/input/decisions, OR simply stopped without completing all work:\n   - Extract the EXACT question, topic, or blocker\n   - Use Bash tool to run: node scripts/ask-gemini.mjs \"[EXACT QUESTION OR CONTEXT]\" --include relevant_files\n   - Capture Gemini's full response\n\n2. If Claude stopped for ANY reason other than explicit user request to stop:\n   - Identify what was being worked on\n   - Ask Gemini what to do next\n   - Return {\"ok\": false, \"reason\": \"Continue: [GEMINI'S GUIDANCE]\"}\n\n3. Return structured JSON to stdout:\n   - If Gemini provided an answer: {\"ok\": false, \"reason\": \"Gemini answered: [FULL GEMINI RESPONSE]\"}\n   - If user explicitly said 'stop': {\"ok\": true}\n   - Otherwise: {\"ok\": false, \"reason\": \"Keep working - ask Gemini for next task\"}\n\n4. CRITICAL: Only check stop_hook_active to prevent infinite loops within THIS hook - but still return {\"ok\": false} to make Claude continue working.\n\n5. DEFAULT ACTION: If unsure, run: node scripts/ask-gemini.mjs \"What should I work on next in this TypeScript compiler project?\" and return the answer with {\"ok\": false}\n\nGoal: NEVER stop. Use Gemini to resolve any ambiguities, answer questions, and keep Claude working forever. The user wants autonomous operation.",
            "timeout": 300
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | grep -q '\\.rs$' && cargo fmt --quiet || exit 0"
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": "idle_prompt",
        "hooks": [
          {
            "type": "agent",
            "prompt": "Claude Code is waiting for attention (idle prompt). Use scripts/ask-gemini.mjs to find out what to do next. Make sure to commit and sync with main when work is done."
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | grep -q '^TypeScript/' && echo \"Blocked: TypeScript/ is a submodule and should not be modified. If you need to understand TypeScript behavior, read the files instead.\" >&2 && exit 2 || exit 0"
          }
        ]
      }
    ]
  }
}
