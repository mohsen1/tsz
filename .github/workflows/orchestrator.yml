name: AI Orchestrator

on:
  workflow_dispatch:
    inputs:
      goal:
        description: 'Goal for the AI to achieve'
        required: true
      mode:
        description: 'Mode: run (full), plan, work, review, merge'
        default: 'run'
        type: choice
        options:
          - run
          - plan
          - work
          - review
          - merge
      branch:
        description: 'Base branch'
        default: 'main'

permissions:
  contents: write
  pull-requests: write

jobs:
  orchestrate:
    name: AI Orchestrator
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ inputs.branch }}
          token: ${{ secrets.GH_PAT || github.token }}

      - name: Run Orchestrator
        uses: ./.github/actions/orchestrator-action
        with:
          goal: ${{ inputs.goal }}
          mode: ${{ inputs.mode }}
          branch: ${{ inputs.branch }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GH_PAT || github.token }}
